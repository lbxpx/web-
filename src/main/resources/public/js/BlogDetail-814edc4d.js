import{d as a,Q as t,r as e,c as s,b as l,e as o,f as n,g as c,t as u,F as d,B as r,J as i,K as v,E as m,j as p,y as h,z as g,_ as y}from"./index-00623a6b.js";import{m as b}from"./marked.esm-d112d5da.js";import{a as f}from"./blog-ad198a8c.js";import{s as j,u as _}from"./users-f5a9a53f.js";const k=a=>(h("data-v-88b46ec5"),a=a(),g(),a),w={class:"blog-detail-page"},x={class:"content"},B={class:"post-detail"},H={class:"post-title"},L={class:"post-date"},M={class:"post-author"},T={class:"tags"},$={class:"post-body"},q={class:"preview"},z=k((()=>c("h3",null,"内容预览",-1))),A=["innerHTML"],C={class:"comments-section"},D=k((()=>c("h2",null,"评论",-1))),E=y(a({__name:"BlogDetail",setup(a){const h=_().username,g=t().query.id,y=e({title:"",date:"",author:"",content:"",tags:[]}),k=e([]),E=e(""),F=async()=>{var a;await(a=g,j({url:`api/comments/${a}`,method:"get"})).then((a=>{1===a.data.code&&(k.value=a.data.data)})).catch((a=>{m.error(a)}))},I=async()=>{var a,t;E.value&&(k.value.push({id:k.value.length+1,author:h,content:E.value}),await(a=g,t={author:h,content:E.value},j({url:`api/comments/${a}`,method:"post",data:{...t}})).then((a=>{1===a.data.code&&m("发布成功")})).catch((a=>{m.error(a)})),E.value="")},J=s((()=>b(y.value.content)));return l((()=>{(async()=>{await f(g).then((a=>{if(1===a.data.code){const t=a.data.data;y.value.title=t.title,y.value.date=t.createdAt,y.value.author=t.authorName,y.value.content=t.content,y.value.tags=t.tags?t.tags.split(",").map((a=>a.trim())):[]}else m(a.data.msg)})).catch((a=>{m.error("请求出错了："+a.message)}))})(),F()})),(a,t)=>(o(),n("div",w,[c("div",x,[c("div",B,[c("h1",H,u(y.value.title),1),c("span",L,u(y.value.date),1),c("div",M,"作者: "+u(y.value.author),1),c("div",T,[(o(!0),n(d,null,r(y.value.tags,(a=>(o(),n("span",{key:a,class:"tag"},u(a),1)))),128))]),c("div",$,[c("div",q,[z,c("div",{innerHTML:J.value},null,8,A)])])]),c("div",C,[D,(o(!0),n(d,null,r(k.value,(a=>(o(),n("div",{key:a.id,class:"comment"},[c("strong",null,u(a.author)+":",1),p(" "+u(a.content),1)])))),128)),i(c("textarea",{"onUpdate:modelValue":t[0]||(t[0]=a=>E.value=a),placeholder:"写下你的评论...",class:"comment-input"},null,512),[[v,E.value]]),c("button",{onClick:I},"发布评论")])])]))}}),[["__scopeId","data-v-88b46ec5"]]);export{E as default};
